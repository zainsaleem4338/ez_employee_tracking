<center><h3>Company Settings</h3></center><br>

<% if @settings.present? %>
	<h4><span data-toggle="collapse" data-target="#_working_days" style='cursor: pointer'><i class="fas fa-arrow-right"></i> Adjust Working Days</span></h4><br>
	<%= form_tag( update_settings_path, method: "patch") do %>
	<div id="_working_days" class="collapse">
	  <div class='row'>
	    <div class='col-sm-4'></div>
	    <div class='col-sm-4'>
	      Start Time
	    </div>
	    <div class='col-sm-4'>
	      End Time
	    </div>
	  </div>
	  <div class='form-group row'>
	    <div class='col-sm-2'>
	      <label class='control-label'>Monday</label>
	    </div>
      <div class='col-sm-1'>
        <label class="switch">
          <%= check_box_tag :monday, false , @settings.working_days['monday'] %>
          <span class="slider round"></span>
        </label>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('monday_start_time', @settings.timings['monday_start_time'], class:'form-control') %>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('monday_end_time', @settings.timings['monday_end_time'], class:'form-control') %>
      </div>
	  </div>
	  <div class='form-group row'>
	    <div class='col-sm-2'>
	      <label class='control-label'>Tuesday</label>
	    </div>
      <div class='col-sm-1'>
        <label class="switch">
          <%= check_box_tag :tuesday, false, @settings.working_days['tuesday'] %>
          <span class="slider round"></span>
        </label>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('tuesday_start_time', @settings.timings['tuesday_start_time'], class:'form-control') %>
       </div>
      <div class='col-sm-4'>
        <%= text_field_tag('tuesday_end_time', @settings.timings['tuesday_end_time'], class:'form-control') %>
      </div>
	  </div>
	  <div class='form-group row'>
	    <div class='col-sm-2'>
	      <label class='control-label'>Wednesday</label>
	    </div>
      <div class='col-sm-1'>
        <label class="switch">
          <%= check_box_tag :wednesday, false, @settings.working_days['wednesday'] %>
          <span class="slider round"></span>
        </label>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('wednesday_start_time', @settings.timings['wednesday_start_time'], class:'form-control') %>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('wednesday_end_time', @settings.timings['wednesday_end_time'], class:'form-control') %>
      </div>
	  </div>
	  <div class='form-group row'>
	    <div class='col-sm-2'>
	      <label class='control-label'>Thursday</label>
	    </div>
      <div class='col-sm-1'>
        <label class="switch">
          <%= check_box_tag :thursday, false, @settings.working_days['thursday'] %>
          <span class="slider round"></span>
        </label>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('thursday_start_time', @settings.timings['thursday_start_time'], class:'form-control') %>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('thursday_end_time', @settings.timings['thursday_end_time'], class:'form-control') %>
      </div>
	  </div>
	  <div class='form-group row'>
	    <div class='col-sm-2'>
	      <label class='control-label'>Friday</label>
	    </div>
      <div class='col-sm-1'>
        <label class="switch">
          <%= check_box_tag :friday, false, @settings.working_days['friday'] %>
          <span class="slider round"></span>
        </label>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('friday_start_time', @settings.timings['friday_start_time'], class:'form-control') %>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('friday_end_time', @settings.timings['friday_end_time'], class:'form-control') %>
      </div>
	  </div>
	  <div class='form-group row'>
	    <div class='col-sm-2'>
	      <label class='control-label'>Saturday</label>
	    </div>
      <div class='col-sm-1'>
        <label class="switch">
          <%= check_box_tag :saturday, false, @settings.working_days['saturday'] %>
          <span class="slider round"></span>
        </label>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('saturday_start_time', @settings.timings['saturday_start_time'], class:'form-control') %>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('saturday_end_time',  @settings.timings['saturday_end_time'], class:'form-control') %>
      </div>
	  </div>
	  <div class='form-group row'>
	    <div class='col-sm-2'>
	      <label class='control-label'>Sunday</label>
	    </div>
      <div class='col-sm-1'>
        <label class="switch">
          <%= check_box_tag :sunday, false, @settings.working_days['sunday'] %>
          <span class="slider round"></span>
        </label>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('sunday_start_time', @settings.timings['sunday_start_time'], class:'form-control') %>
      </div>
      <div class='col-sm-4'>
        <%= text_field_tag('sunday_end_time', @settings.timings['sunday_end_time'], class:'form-control') %>
      </div>
	  </div>
	</div>
	<%= hidden_field_tag :holidays, id: 'holidays', value: "" %>
	  <h4><span data-toggle="collapse" data-target="#_holidays" style='cursor: pointer'><i class="fas fa-arrow-right"></i> Public holidays</span></h4><br>
	  <div id='_holidays' class='collapse'>
	    <div class='form-group'>
	    	<button id='_btn_add' class='btn btn-default btn-lg' type='button'><i class="fas fa-plus-circle"></i> Add</button>
	    </div>
	    <div id='_labels'>
	    	<div class='row'>
	    		<div class='col-md-6'>
	    			<center><b>Select Date</b></center>
	    		</div>
	    		<div class='col-md-6'>
	    			<center><b>Every Year</b></center>
	    		</div>
	    	</div>
	    	<br>
	    </div>
	    <% if @settings.holidays.present? %>
			  <% @settings.holidays.each do |key, val| %>
			    <div class='form-group holidays'>
			    	<div class='row'>
			    		<div class='col-md-6'>
			    			<%= date_field_tag "holiday_date_#{key}", @settings.holidays[key]["holiday_date_#{key}"] ,class:'form-control holiday-date-field' %>
			    		</div>
			    		<div class='col-md-6'>
			    			<center>
			    				<label class='switch'>
			    					<%= check_box_tag "every_year_#{key}", true, @settings.holidays[key]["every_year_#{key}"] , class:'every_year-field'  %>
			    					<span class='slider round'></span>
			    				</label>
			    			</center>
			    		</div>
			    	</div>
			    </div>
				<% end %>
			<% end %>
	  </div> 
	  <h4><span data-toggle="collapse" data-target="#allocated_leaves" style='cursor: pointer'><i class="fas fa-arrow-right"></i> Allocated Leaves & Attendance Threshold</span></h4><br>
	  <div id='allocated_leaves' class='collapse'>
	  	<div class='row'>
		  	<div class='col-md-6'>
					<%= number_field_tag :allocated_leaves, @settings.allocated_leaves, class:'form-control', placeholder:'Enter a number',step: :any %>
	     	</div>
	     	<div class='col-md-6'>
					<%= number_field_tag(:attendance_time, @settings.attendance_time, class:'form-control', placeholder:'Enter Time(minutes)') %>
	     	</div>
     	</div>
	  </div>
    <h4><span data-toggle="collapse" data-target="#task_alert" style='cursor: pointer'><i class="fas fa-arrow-right"></i> Alerts Critical Deadlines</span></h4><br>
    <div id='task_alert' class='collapse'>
      <div class='row'>
        <div class='col-md-6'>
          <%= number_field_tag :task_alert, @settings.task_alert, class:'form-control', placeholder:'Enter a number',step: :any %>
        </div>
        <div class='col-md-6'>
          <span><b>Days</b></span>
        </div>
      </div>
    </div><br>
	  <div class='form-group'>
	    <%= submit_tag("Save Settings", id:'save_btn',class:'btn btn-dark btn-block') %>
	  </div>
		<% end %>
	<% else %>
  <center><h3>Settings does not exist!</h3></center>
<%end%>

<script type='text/javascript'> 
  $( document ).ready(function() {
    $('#monday_start_time').timepicki();
    $('#monday_end_time').timepicki();
    $('#tuesday_start_time').timepicki();
    $('#tuesday_end_time').timepicki();
    $('#wednesday_start_time').timepicki();
    $('#wednesday_end_time').timepicki();
    $('#thursday_start_time').timepicki();
    $('#thursday_end_time').timepicki();
    $('#friday_start_time').timepicki();
    $('#friday_end_time').timepicki();
    $('#saturday_start_time').timepicki();
    $('#saturday_end_time').timepicki();
    $('#sunday_start_time').timepicki();
    $('#sunday_end_time').timepicki();  

    $('#_btn_add').click(function() {
    	$('#_holidays').append("<div class='form-group holidays'><div class='row'><div class='col-md-6'><%= escape_javascript(date_field_tag 'holiday_date', {} ,class:'form-control holiday-date-field') %></div><div class='col-md-6'><center><label class='switch'><%= escape_javascript(check_box_tag 'every_year', false, false ,class:'every_year-field' ) %><span class='slider round'></span></label></center></div></div></div>");
	 	  $('.holiday-date-field:last').attr('id', 'holiday_date_' + $('.holidays').length);
	 	  $('.holiday-date-field:last').attr('name', 'holiday_date_' + $('.holidays').length);
	 	  $('.every_year-field:last').attr('id', 'every_year_' + $('.holidays').length);
	 	  $('.every_year-field:last').attr('name', 'every_year_' + $('.holidays').length);
    });

     $('#save_btn').click(function() {
     		var obj = {}; 
     		var count = 1;
     		while($('#holiday_date_'+count).val()!==undefined){
     			if ($('#holiday_date_'+count).val() !== ""){
	     			var public_holiday = {};
	     			public_holiday['holiday_date_'+count] = $('#holiday_date_'+count).val();
	     			if ($('#every_year_'+count+':checkbox:checked').length > 0) {
	     				public_holiday['every_year_'+count] = true;
	     			}
	     			else{
	     				public_holiday['every_year_'+count] = false;
	     			}
	     			obj[count] = public_holiday;
	     			public_holiday = {};
	     		}
	     		else{
	     			break;
	     		}
	     		count += 1;
     		}
	     	$('#holidays').val(JSON.stringify(obj));

     });


  });
</script>